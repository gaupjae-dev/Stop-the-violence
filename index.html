<!DOCTYPE html>
<html>
<head>
    <title>3D Explorer - Character Edition</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #ui {
            position: absolute; top: 10px; left: 10px;
            color: white; background: rgba(0,0,0,0.7); padding: 15px;
            border-radius: 8px; pointer-events: none;
        }
        kbd { background: #444; border-radius: 3px; padding: 2px 5px; border: 1px solid #777; }
    </style>
</head>
<body>
    <div id="ui">
        <div>Move: <kbd>W</kbd> <kbd>A</kbd> <kbd>S</kbd> <kbd>D</kbd> | Jump: <kbd>Space</kbd></div>
    </div>
    
    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040, 1.5));

        // Ground
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(200, 200),
            new THREE.MeshStandardMaterial({ color: 0x2e7d32 })
        );
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // --- HUMANOID PLAYER SETUP ---
        const playerGroup = new THREE.Group();
        const skinMat = new THREE.MeshStandardMaterial({ color: 0xffdbac }); // Skin tone
        const clothMat = new THREE.MeshStandardMaterial({ color: 0x1976d2 }); // Blue shirt
        const pantMat = new THREE.MeshStandardMaterial({ color: 0x333333 }); // Dark pants

        // Torso
        const torso = new THREE.Mesh(new THREE.BoxGeometry(0.8, 1, 0.5), clothMat);
        torso.position.y = 1.5;
        playerGroup.add(torso);

        // Head
        const head = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 0.5), skinMat);
        head.position.y = 2.3;
        playerGroup.add(head);

        // Arms
        const armGeo = new THREE.BoxGeometry(0.3, 0.8, 0.3);
        const leftArm = new THREE.Mesh(armGeo, skinMat);
        leftArm.position.set(-0.6, 1.5, 0);
        playerGroup.add(leftArm);

        const rightArm = new THREE.Mesh(armGeo, skinMat);
        rightArm.position.set(0.6, 1.5, 0);
        playerGroup.add(rightArm);

        // Legs
        const legGeo = new THREE.BoxGeometry(0.35, 1, 0.35);
        const leftLeg = new THREE.Mesh(legGeo, pantMat);
        leftLeg.position.set(-0.25, 0.5, 0);
        playerGroup.add(leftLeg);

        const rightLeg = new THREE.Mesh(legGeo, pantMat);
        rightLeg.position.set(0.25, 0.5, 0);
        playerGroup.add(rightLeg);

        scene.add(playerGroup);

        // --- WORLD OBJECTS ---
        function createTree(x, z) {
            const treeGroup = new THREE.Group();
            const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.2, 1.5), new THREE.MeshStandardMaterial({ color: 0x5d4037 }));
            trunk.position.y = 0.75;
            const leaves = new THREE.Mesh(new THREE.ConeGeometry(1.2, 2.5, 8), new THREE.MeshStandardMaterial({ color: 0x1b5e20 }));
            leaves.position.y = 2.5;
            treeGroup.add(trunk); treeGroup.add(leaves);
            treeGroup.position.set(x, 0, z);
            scene.add(treeGroup);
        }
        createTree(5, -5); createTree(-5, -10);

        // --- CONTROLS & PHYSICS ---
        const keys = { w: false, a: false, s: false, d: false, ' ': false };
        let velocityY = 0;
        const gravity = -0.012;
        const jumpStrength = 0.25;
        let isGrounded = true;
        let walkCycle = 0;

        window.addEventListener('keydown', (e) => { if (e.key === ' ') keys[' '] = true; else keys[e.key.toLowerCase()] = true; });
        window.addEventListener('keyup', (e) => { if (e.key === ' ') keys[' '] = false; else keys[e.key.toLowerCase()] = false; });

        function animate() {
            requestAnimationFrame(animate);

            let isMoving = false;
            if (keys.w) { playerGroup.position.z -= 0.12; isMoving = true; }
            if (keys.s) { playerGroup.position.z += 0.12; isMoving = true; }
            if (keys.a) { playerGroup.position.x -= 0.12; isMoving = true; }
            if (keys.d) { playerGroup.position.x += 0.12; isMoving = true; }

            // Jumping
            if (keys[' '] && isGrounded) { velocityY = jumpStrength; isGrounded = false; }
            velocityY += gravity;
            playerGroup.position.y += velocityY;
            if (playerGroup.position.y <= 0) { playerGroup.position.y = 0; velocityY = 0; isGrounded = true; }

            // Walking Animation
            if (isMoving && isGrounded) {
                walkCycle += 0.15;
                leftArm.rotation.x = Math.sin(walkCycle) * 0.5;
                rightArm.rotation.x = -Math.sin(walkCycle) * 0.5;
                leftLeg.rotation.x = -Math.sin(walkCycle) * 0.5;
                rightLeg.rotation.x = Math.sin(walkCycle) * 0.5;
            } else {
                // Reset positions when standing still
                leftArm.rotation.x = 0;
                rightArm.rotation.x = 0;
                leftLeg.rotation.x = 0;
                rightLeg.rotation.x = 0;
            }

            camera.position.x = playerGroup.position.x;
            camera.position.z = playerGroup.position.z + 10;
            camera.position.y = playerGroup.position.y + 5;
            camera.lookAt(playerGroup.position.x, playerGroup.position.y + 1.5, playerGroup.position.z);

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
